var additivemc=additivemc||{};additivemc.fn=additivemc.fn||{},additivemc.fn.private=additivemc.fn.private||{},additivemc.const=additivemc.const||{},additivemc.const.backend_host="https://tr.additive-apps.tech",additivemc.const.cookie_domain=additivemc.const.cookie_domain||"",additivemc.const.tracking_entity=additivemc.const.tracking_entity||"",additivemc.fn.post_url=function(){return additivemc.const.backend_host+"/"+additivemc.const.tracking_entity+"/tracking"},additivemc.fn.gif_url=function(){return additivemc.const.backend_host+"/"+additivemc.const.tracking_entity+"/pixel.gif"},additivemc.fn.createCookie=function(e,t,i,n){console.log("setting: "+e+" for: "+t);let d="",o="";if(t&&(o="; domain="+t),n){let e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),d="; expires="+e.toUTCString()}document.cookie=e+"="+i+d+o+"; path=/"},additivemc.fn.readCookie=function(e){let t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let n=i[e];for(;" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},additivemc.fn.eraseCookie=function(e){additivemc.fn.createCookie(e,"","",-1)},additivemc.fn.parseHashParams=function(){let e=window.location.hash;if(-1==e.indexOf("#")||-1==e.indexOf("?"))return!1;let t=e.split("?")[1].split("&"),i=t.length,n={};for(;i--;){let e=t[i].split("=");n[e[0]]=e.length>1?e[1]:null}return n},additivemc.fn.getClientData=function(e){return{uuid:additivemc.fn.uuid(),page:e||document.location.href,ma_uuid:additivemc.fn.maUUID(),session_uuid:additivemc.fn.sessionUUID(),fingerprint:"",language:additivemc.fn.clientJS.getLanguage(),user_agent:navigator.userAgent,os:additivemc.fn.clientJS.getOS(),os_version:additivemc.fn.clientJS.getOSVersion(),device_vendor:additivemc.fn.clientJS.getDeviceVendor(),device_type:additivemc.fn.clientJS.getDeviceType(),device:additivemc.fn.clientJS.getDevice(),browser:additivemc.fn.clientJS.getBrowser(),browser_version:additivemc.fn.clientJS.getBrowserVersion(),current_resolution:additivemc.fn.clientJS.getCurrentResolution(),available_resolution:additivemc.fn.clientJS.getAvailableResolution(),referrer:document.referrer}},additivemc.fn.post=function(e,t){let i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.send(JSON.stringify(t))},additivemc.fn.get=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=function(){if(i.status>=200&&i.status<400){let e=i.responseText;t(e)}},i.onerror=function(){},i.send()},additivemc.fn.getJSON=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=function(){if(i.status>=200&&i.status<400){let e=JSON.parse(i.responseText);t(e)}},i.onerror=function(){},i.send()},additivemc.fn.random_string=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},additivemc.fn.append_pixel=function(e){let t=document.createElement("IMG");t.setAttribute("src",additivemc.fn.gif_url()+"?r="+additivemc.fn.random_string()+"&payload="+btoa(JSON.stringify({meta_data:additivemc.fn.getClientData(e)}))),t.setAttribute("height","1"),t.setAttribute("width","1"),t.setAttribute("style","position:absolute; visibility:hidden; bottom: 0; left: 0;"),document.body.appendChild(t)},additivemc.fn.conv=function(e){let t=e[2],i=null;i="object"==typeof e[3]?e[3]:{transaction:{resource:{authority:e[3],id:e[4]},conversion_value:e[5]}};let n=btoa(JSON.stringify({meta_data:additivemc.fn.getClientData(null),conversion:{category:t,data:i}})),d=document.createElement("IMG");d.setAttribute("src",additivemc.fn.gif_url()+"?r="+additivemc.fn.random_string()+"&payload="+n),d.setAttribute("height","1"),d.setAttribute("width","1"),d.setAttribute("style","position:absolute; visibility:hidden; bottom: 0; left: 0;"),document.body.appendChild(d)},additivemc.fn.roomRequestConversion=function(e){e.resource=e.resource||{},e.resource.request_authority=e.resource.request_authority||"additive-inquiry-app",additivemc.fn.conv("SalesOpportunityConversion",{types:{main:"HotelEnquiry",sub:"RoomEnquiry"},transaction:{resource:{id:e.resource.request_id,authority:e.resource.request_authority},email:e.email,start_date:e.start_date,end_date:e.end_date}})},additivemc.fn.hotelStaySalesConversion=function(e){additivemc.fn.conv("SalesConversion",e)},additivemc.fn.voucherSalesConversion=function(e){e.resource=e.resource||{},e.resource.request_authority=e.resource.request_authority||"additive-voucher-app";let t={types:{main:"ProductOrder",sub:"VoucherOrder"},transaction:{resource:{id:e.resource.request_id,authority:e.resource.request_authority},email:e.email}};null!=e.conversion_value&&(t.conversion_value=e.conversion_value),console.log(t),additivemc.fn.conv("SalesConversion",t)},additivemc.fn.newsletterSubscriptionConversion=function(e){e.resource=e.resource||{},e.channels=e.channels||{},e.resource.request_authority=e.resource.request_authority||"additive-newsletter-app",e.channels.main=e.channels.main||additivemc.const.tracking_entity,e.channels.sub=e.channels.sub||"additive-newsletter-widget";let t={types:{main:"NewsletterSubscription"},channels:e.channels,transaction:{resource:{id:e.resource.request_id,authority:e.resource.request_authority},email:e.email}};additivemc.fn.conv("LeadConversion",t)},additivemc.fn.generateUUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},additivemc.fn.uuid=function(){return additivemc.fn.readCookie("additivemc_uuid")},additivemc.fn.sessionUUID=function(){let e=additivemc.fn.readCookie("additivemc_session_uuid");return null!=e&&""!=e||(null==(e=additivemc.fn.readCookie("t17v_session_uuid"))||""==e?(additivemc.fn.createCookie("additivemc_session_uuid","",additivemc.fn.generateUUID()),e=additivemc.fn.readCookie("additivemc_session_uuid")):(additivemc.fn.createCookie("additivemc_session_uuid","",e),additivemc.fn.eraseCookie("t17v_session_uuid"))),e},additivemc.fn.maUUID=function(){let e=additivemc.fn.parseHashParams().ma_uuid;return null!=e?additivemc.fn.createCookie("additivemc_ma_uuid","",e,3650):e=additivemc.fn.readCookie("t17v_ma_uuid"),e},additivemc.fn.setCookies=function(){additivemc.fn.maUUID()},additivemc.fn.documentReady=function(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)},additivemc.fn.getScript=function(e,t){let i=document.createElement("script"),n=document.getElementsByTagName("script")[0];i.async=1,i.onload=i.onreadystatechange=function(e,n){(n||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,i=void 0,n||t&&t())},i.src=e,n.parentNode.insertBefore(i,n)},additivemc.fn.idf=function(e){null==additivemc.fn.maUUID()&&(e.cookie_uuid=additivemc.fn.uuid(),e.session_uuid=additivemc.fn.sessionUUID(),additivemc.fn.post(additivemc.fn.post_url()+"/idf",e))},additivemc.fn.track=function(e){e=e||window.location.href;let t=additivemc.fn.uuid();null==t||""==t?additivemc.fn.migrate_cookie(function(){additivemc.fn.append_pixel(e)}):additivemc.fn.append_pixel(e)},additivemc.fn.migrate_cookie=function(e){window.onmessage=function(t){if("https://mc-api.trick17.it"==t.origin){console.log(t);let i=JSON.parse(t.data);"cookie_migration"==i.type&&null!=i.data&&""!=i.data?additivemc.fn.createCookie("additivemc_uuid",additivemc.const.cookie_domain,i.data,10950,!0):additivemc.fn.createCookie("additivemc_uuid",additivemc.const.cookie_domain,additivemc.fn.generateUUID(),10950,!0);let n=document.getElementById("cookieMigration");n.parentNode.removeChild(n),e()}};let t="https://mc-api.trick17.it/"+additivemc.const.tracking_entity+"/tracking/uuid",i=document.createElement("iframe");i.setAttribute("src",t),i.setAttribute("id","cookieMigration"),i.setAttribute("height","1"),i.setAttribute("width","1"),i.setAttribute("style","position:absolute!important; visibility:hidden!important; bottom: 0; left: 0;"),document.body.appendChild(i)},additivemc.fn.add_mapper_script=function(){additivemc.fn.getScript(additivemc.const.backend_host+"/mapper.js",function(){})},additivemc.fn.init=function(e){console.log("INITIALIZING"),additivemc.const.tracking_entity=e[1],additivemc.const.cookie_domain=e[2]},additivemc.fn.send=function(e){switch(e[1]){case"pageview":console.log("TRACKING PAGEVIEW"),additivemc.fn.track();break;case"conversion":console.log("TRACKING CONVERSION"),additivemc.fn.conv(e);break;default:console.log("WRONG TRACKING ACTION")}},additivemc.fn.work_loop=function(){for(;ddtv.q.length;){let e=ddtv.q.shift();switch(e[0]){case"init":additivemc.fn.init(e);break;case"send":additivemc.fn.send(e);break;default:console.log("WRONG TRACKING ACTION")}console.log()}setTimeout(additivemc.fn.work_loop,500)},additivemc.fn.getScript("https://cdnjs.cloudflare.com/ajax/libs/ClientJS/0.1.11/client.min.js",function(){additivemc.fn.clientJS=new ClientJS,additivemc.fn.work_loop(),console.log("LOADED ALL TRACKING SCRIPTS")});
